# Roadmap del Proyecto DFS-Invest-Suite

Este documento detalla las fases, hitos y tareas planificadas para el desarrollo de la plataforma DFS-Invest-Suite. Se actualizarÃ¡ continuamente a medida que el proyecto avance.

## Leyenda de Prioridades/Estado (Ejemplo)

- ğŸ”´ **Bloqueante / CrÃ­tico**
- ğŸŸ  **Alta Prioridad**
- ğŸŸ¡ **Media Prioridad**
- ğŸŸ¢ **Baja Prioridad**
- âœ… **Completado**
- â³ **En Progreso**
- ğŸ…¿ï¸ **Pendiente**

---

## Fase 0: FundaciÃ³n, Estructura y Herramientas (Arquitectura Base)

**Objetivo:** Establecer un monorepo Nx funcional con todas las herramientas de desarrollo y calidad configuradas, convenciones establecidas, librerÃ­as base de la arquitectura hexagonal/DDD definidas, y un pipeline de CI bÃ¡sico operativo.

### Hito 0.1: ConfiguraciÃ³n Inicial del Workspace (âœ… Completado)

- âœ… CreaciÃ³n del workspace Nx con `pnpm`.
- âœ… ConfiguraciÃ³n de `api-main` como aplicaciÃ³n NestJS inicial.
- âœ… ConfiguraciÃ³n de `api-main-e2e` para tests E2E.
- âœ… ActualizaciÃ³n de `nx.json` (`defaultBase: "main"`).
- âœ… ActualizaciÃ³n de `README.md` inicial.
- âœ… CreaciÃ³n de `BITACORA-DE-DESARROLLO.md`.

### Hito 0.2: CreaciÃ³n de LibrerÃ­as Compartidas (`libs/shared/*`) (âœ… Completado)

- âœ… **`shared-types`**: DefiniciÃ³n de tipos e interfaces globales.
  - Ruta: `libs/shared/types/`
  - Alias: `@dfs-suite/shared-types`
  - Artefactos Clave: `IApiResponse`, `IPaginatedQueryParams`, `IPaginated`, `TenantId`, `UserId`, `AggregateId`, `IsoDateString`, `Maybe`, `ObjectLiteral`, `Brand`, `CorrelationId`.
- âœ… **`shared-result`**: ImplementaciÃ³n del tipo `Result<T, E>`.
  - Ruta: `libs/shared/result/`
  - Alias: `@dfs-suite/shared-result`
  - Artefactos Clave: `Ok<T,E>`, `Err<E,T>`, `Result<T,E>`, utilidades `ok()`, `err()`.
- âœ… **`shared-errors`**: Clases de error base y cÃ³digos genÃ©ricos.
  - Ruta: `libs/shared/errors/`
  - Alias: `@dfs-suite/shared-errors`
  - Artefactos Clave: `ExceptionBase`, `SerializedException`, cÃ³digos y clases de error genÃ©ricas.
- âœ… **`shared-utils`**: Utilidades puras (Guard, UuidUtils).
  - Ruta: `libs/shared/utils/`
  - Alias: `@dfs-suite/shared-utils`
  - Artefactos Clave: `Guard`, `UuidUtils`.
  - Dependencias: `uuid`, `@types/uuid`.
- âœ… **`shared-constants`**: Constantes globales (paginaciÃ³n, regex).
  - Ruta: `libs/shared/constants/`
  - Alias: `@dfs-suite/shared-constants`
  - Artefactos Clave: `pagination.constants.ts`, `regex.constants.ts`.
- âœ… **`shared-validation-schemas`**: Esquemas de validaciÃ³n con Zod.
  - Ruta: `libs/shared/validation-schemas/`
  - Alias: `@dfs-suite/shared-validation-schemas`
  - Dependencias: `zod`.
  - Artefactos Clave: `zod.instance.ts`, `common.schemas.ts`, `pagination.schemas.ts`.

### Hito 0.3: CreaciÃ³n de LibrerÃ­as del Shared Kernel del Dominio (`libs/core/domain/shared-kernel/*`) (âœ… Completado)

- âœ… **`core-domain-shared-kernel-entities`**: Clases base `Entity` y `AggregateRoot`.
  - Ruta: `libs/core/domain/shared-kernel/entities/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-entities`
- âœ… **`core-domain-shared-kernel-value-objects`**: Clase base `ValueObject`.
  - Ruta: `libs/core/domain/shared-kernel/value-objects/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-value-objects`
  - Deuda TÃ©cnica: Error de lint `@typescript-eslint/no-unsafe-return` en `unpack()` desactivado.
- âœ… **`core-domain-shared-kernel-events`**: Interfaces y base para Eventos de Dominio.
  - Ruta: `libs/core/domain/shared-kernel/events/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-events`
- âœ… **`core-domain-shared-kernel-ports`**: Interfaces base para Puertos (Repositorio, Logger).
  - Ruta: `libs/core/domain/shared-kernel/ports/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-ports`
- âœ… **`core-domain-shared-kernel-commands-queries`**: Interfaces y base para Comandos y Queries.
  - Ruta: `libs/core/domain/shared-kernel/commands-queries/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-commands-queries`
- âœ… **`core-domain-shared-kernel-mappers`**: Interfaz base para Mappers.
  - Ruta: `libs/core/domain/shared-kernel/mappers/`
  - Alias: `@dfs-suite/core-domain-shared-kernel-mappers`

### Hito 0.4: ConfiguraciÃ³n Avanzada de ESLint y VerificaciÃ³n (âœ… Completado)

- âœ… **Tarea 0.4.1:** Refinar `depConstraints` en `eslint.config.mjs` (raÃ­z) para hacer cumplir estrictamente la arquitectura hexagonal entre todas las capas y librerÃ­as creadas.
  - **LÃ³gica/Flujo:** Se definirÃ¡n reglas precisas para quÃ© tags pueden depender de quÃ© otros tags, basÃ¡ndose en `layer:*`, `scope:*` y `type:*`. Por ejemplo, `layer:domain` no podrÃ¡ importar de `layer:infrastructure`.
  - **Artefacto:** `eslint.config.mjs`.
- âœ… **Tarea 0.4.2:** Ejecutar `pnpm nx run-many --target=lint --all --skip-nx-cache` y resolver cualquier violaciÃ³n de dependencia.
- âœ… **Tarea 0.4.3 (Opcional):** Eliminar archivos de ejemplo (`*.ts` y `*.spec.ts`) de todas las librerÃ­as creadas si no se ha hecho ya.
- âœ… **Tarea 0.4.4:** Asegurar que `pnpm nx run-many --target=test --all` pase (la mayorÃ­a indicarÃ¡ "no tests found").

### Hito 0.5: Estructura Base del Dominio `Tenancy` (ğŸ…¿ï¸ Pendiente)

- ğŸ…¿ï¸ **Tarea 0.5.1:** Crear librerÃ­a `libs/core/domain/tenancy` (`@dfs-suite/core-domain-tenancy`).
  - **LÃ³gica/Flujo:** ContendrÃ¡ las entidades (`TenantEntity`, `TenantConfigurationEntity`), VOs (`TenantStatus`, `DbConnectionConfigVO`), eventos, y puertos de repositorio (`ITenantRepository`, `ITenantConfigurationRepository`) especÃ­ficos para el dominio `tenancy`.
  - **Artefactos:** `tenant.entity.ts`, `tenant-status.vo.ts`, `ITenantRepository.port.ts`, etc.
  - **Ruta:** `libs/core/domain/tenancy/`
- ğŸ…¿ï¸ **Tarea 0.5.2:** Crear librerÃ­a `libs/core/application/tenancy` (`@dfs-suite/core-application-tenancy`).
  - **LÃ³gica/Flujo:** ContendrÃ¡ los Casos de Uso (Commands/Queries handlers) para `tenancy` (ej. `CreateTenantUseCase`, `GetTenantDetailsQueryHandler`). TambiÃ©n los DTOs de aplicaciÃ³n y puertos para servicios de aplicaciÃ³n (ej. `IDatabaseProvisioningServicePort`).
  - **Artefactos:** `create-tenant.command.ts`, `create-tenant.use-case.ts`, etc.
  - **Ruta:** `libs/core/application/tenancy/`

### Hito 0.6: Estructura Base de Infraestructura para `Tenancy` (ğŸ…¿ï¸ Pendiente)

- ğŸ…¿ï¸ **Tarea 0.6.1:** Crear librerÃ­a `libs/infrastructure/persistence/prisma-shared` (`@dfs-suite/infrastructure-persistence-prisma-shared`).
  - **LÃ³gica/Flujo:** ProveerÃ¡ `PrismaClientFactory` o `DynamicPrismaService` para conexiones multi-tenant y a la DB de plataforma.
  - **Artefactos:** `prisma-client.factory.ts`, `prisma-shared.module.ts`.
  - **Ruta:** `libs/infrastructure/persistence/prisma-shared/`
- ğŸ…¿ï¸ **Tarea 0.6.2:** Crear librerÃ­a `libs/infrastructure/persistence/tenancy-prisma-adapter` (`@dfs-suite/infrastructure-persistence-tenancy-prisma`).
  - **LÃ³gica/Flujo:** ImplementarÃ¡ `ITenantRepository` e `ITenantConfigurationRepository` usando Prisma para la DB de plataforma.
  - **Artefactos:** `tenant.prisma-repository.ts`, `tenant.prisma-mapper.ts`.
  - **Ruta:** `libs/infrastructure/persistence/tenancy-prisma-adapter/`
- ğŸ…¿ï¸ **Tarea 0.6.3:** Crear librerÃ­a `libs/infrastructure/database-provisioning/postgres-provisioner` (`@dfs-suite/infrastructure-db-provisioning-postgres`).
  - **LÃ³gica/Flujo:** ImplementarÃ¡ `IDatabaseProvisioningServicePort` para PostgreSQL.
  - **Artefactos:** `postgres-database-provisioning.service.ts`.
  - **Ruta:** `libs/infrastructure/database-provisioning/postgres-provisioner/`
- ğŸ…¿ï¸ **Tarea 0.6.4:** Crear librerÃ­a `libs/infrastructure/event-emitters/nest-event-emitter-adapter` (`@dfs-suite/infrastructure-events-nest-emitter`).
  - **LÃ³gica/Flujo:** ImplementarÃ¡ `IDomainEventEmitter` usando `@nestjs/event-emitter`.
  - **Artefactos:** `nest-domain-event-emitter.adapter.ts`.
  - **Ruta:** `libs/infrastructure/event-emitters/nest-event-emitter-adapter/`
- ğŸ…¿ï¸ **Tarea 0.6.5 (Opcional si no se hace en `prisma-shared`):** Implementar `TenantContextService` y `TenantContextMiddleware` (podrÃ­a ser en `apps/api-main` o una lib `infrastructure/nest-middleware`).

### Hito 0.7: ConfiguraciÃ³n de Logger y Otros Servicios de Infraestructura Base (ğŸ…¿ï¸ Pendiente)

- ğŸ…¿ï¸ **Tarea 0.7.1:** Crear librerÃ­a `libs/infrastructure/observability/pino-logger-adapter` (`@dfs-suite/infrastructure-observability-pino-logger-adapter`).
  - **LÃ³gica/Flujo:** ImplementarÃ¡ `ILoggerPort` usando Pino.
  - **Artefactos:** `pino.logger-adapter.ts`.
  - **Ruta:** `libs/infrastructure/observability/pino-logger-adapter/`
- ğŸ…¿ï¸ **Tarea 0.7.2:** Configurar `api-main` para usar el logger implementado.

### Hito 0.8: Ensamblaje Inicial en `api-main` (ğŸ…¿ï¸ Pendiente)

- ğŸ…¿ï¸ **Tarea 0.8.1:** Crear `TenancyModule` en `apps/api-main` que importe y conecte los casos de uso de aplicaciÃ³n `tenancy` con sus adaptadores de infraestructura.
- ğŸ…¿ï¸ **Tarea 0.8.2:** Implementar un endpoint bÃ¡sico de `POST /tenants` (para `CreateTenantUseCase`) y `GET /tenants/:id` (para `GetTenantDetailsQueryHandler`) en `api-main` para verificar el flujo completo.
  - **LÃ³gica/Flujo:** El controlador recibirÃ¡ el request, lo mapearÃ¡ a un Comando/Query, lo enviarÃ¡ al Caso de Uso, el Caso de Uso interactuarÃ¡ con el Dominio y los Puertos de Infraestructura, la Infraestructura (con Prisma y el `DynamicPrismaService`) interactuarÃ¡ con la(s) DB(s), y la respuesta (un `Result`) volverÃ¡ al controlador para ser mapeada a una respuesta HTTP.
- ğŸ…¿ï¸ **Tarea 0.8.3:** Escribir tests E2E bÃ¡sicos para estos endpoints.

---

## Fase 1: MVP Funcional - NÃºcleo de WhatsApp y Leads (ğŸ…¿ï¸ Pendiente)

- ### Hito 1.1: Dominio WhatsApp y Anti-Ban
  - ğŸ…¿ï¸ LibrerÃ­as `core/domain/whatsapp`, `core/application/whatsapp`.
  - ğŸ…¿ï¸ LibrerÃ­as `core/domain/anti-ban`, `core/application/anti-ban`.
  - ğŸ…¿ï¸ Adaptadores de infraestructura para WhatsApp Cloud API.
  - ğŸ…¿ï¸ Adaptadores de infraestructura para persistencia de `WhatsAppAccount` y rate limiting (Redis).
- ### Hito 1.2: Dominio Leads-Flow (Extendido)
  - ğŸ…¿ï¸ LibrerÃ­as `core/domain/leads-flow`, `core/application/leads-flow`.
  - ğŸ…¿ï¸ Adaptadores de infraestructura para persistencia de `Lead`, `LeadInteraction`.
- ### Hito 1.3: IntegraciÃ³n en `api-main`
  - ğŸ…¿ï¸ Endpoints para enviar mensajes, recibir webhooks, gestionar leads.
- ### Hito 1.4: PWA Supervisor (Funcionalidad MÃ­nima)
  - ğŸ…¿ï¸ CreaciÃ³n de `apps/pwa-supervisor`.
  - ğŸ…¿ï¸ AutenticaciÃ³n, visualizaciÃ³n de salud de nÃºmeros WA, envÃ­o manual de plantillas.
- ... (MÃ¡s detalle en prompts futuros) ...

---

## Fase 2: PWA Consultor y Funcionalidades Avanzadas (ğŸ…¿ï¸ Pendiente)

- ... (MÃ¡s detalle en prompts futuros) ...

---

## Fase 3: MÃ³dulos Adicionales (Portal, Admin Platform) (ğŸ…¿ï¸ Pendiente)

- ... (MÃ¡s detalle en prompts futuros) ...

---

## Fase X: TokenizaciÃ³n y Web3 (ğŸ…¿ï¸ Pendiente)

- ... (MÃ¡s detalle en prompts futuros) ...

---

ACTUALIZACION DE LA BITACORA

### Hito 0.5: Estructura Base del Dominio `Tenancy` (â³ En Progreso)

- â³ **Tarea 0.5.1:** Implementar lÃ³gica y tests para `libs/core/domain/tenancy`.
  - âœ… Entidades: `TenantEntity`, `TenantConfigurationEntity`.
  - âœ… Value Objects: `TenantStatusVO`, `DbConnectionConfigVO`.
  - âœ… Eventos: `TenantCreatedEvent`, `TenantActivatedEvent`, `TenantSuspendedEvent`.
  - âœ… Puertos de Repositorio: `ITenantRepository`, `ITenantConfigurationRepository`.
  - âœ… Errores de Dominio: `TenantAlreadyExistsError`, `InvalidTenantStatusTransitionError`.
  - âœ… Tests Unitarios para los artefactos anteriores.
- ğŸ…¿ï¸ **Tarea 0.5.2:** Implementar Casos de Uso iniciales y tests para `libs/core/application/tenancy`.
  - **LÃ³gica/Flujo:** ContendrÃ¡ los Casos de Uso (Commands/Queries handlers) para `tenancy` (ej. `CreateTenantUseCase`, `ActivateTenantUseCase`, `GetTenantDetailsQueryHandler`). TambiÃ©n los DTOs de aplicaciÃ³n y puertos para servicios de aplicaciÃ³n (ej. `IDatabaseProvisioningServicePort`).
  - **Artefactos:** `create-tenant.use-case.ts`, `activate-tenant.use-case.ts`, etc.
  - **Ruta:** `libs/core/application/tenancy/`
  ***
  ACTUALIZACION

### Hito 0.4: ConfiguraciÃ³n Avanzada de ESLint y VerificaciÃ³n (âœ… Completado)

- âœ… **Tarea 0.4.1:** Refinar `depConstraints` en `eslint.config.mjs` (raÃ­z).
- âœ… **Tarea 0.4.2:** Ejecutar `pnpm nx run-many --target=lint --all --skip-nx-cache` y resolver violaciones.
- âœ… **Tarea 0.4.3:** Eliminar archivos de ejemplo (`*.ts` y `*.spec.ts`) de todas las librerÃ­as.
- âœ… **Tarea 0.4.4:** Asegurar que `pnpm nx run-many --target=test --all` pase.

### Hito 0.5: Estructura Base del Dominio `Tenancy` (â³ En Progreso)

- âœ… **Tarea 0.5.1:** Implementar lÃ³gica y tests para `libs/core/domain/tenancy`.
  - âœ… Entidades: `TenantEntity`, `TenantConfigurationEntity`.
  - âœ… Value Objects: `TenantStatusVO`, `DbConnectionConfigVO`.
  - âœ… Eventos: `TenantCreatedEvent`, `TenantActivatedEvent`, `TenantSuspendedEvent`.
  - âœ… Puertos de Repositorio: `ITenantRepository`, `ITenantConfigurationRepository`.
  - âœ… Errores de Dominio: `TenantAlreadyExistsError`, `InvalidTenantStatusTransitionError`.
  - âœ… Tests Unitarios exhaustivos para los artefactos anteriores (65 tests pasando).
- ğŸ…¿ï¸ **Tarea 0.5.2:** Implementar Casos de Uso iniciales y tests para `libs/core/application/tenancy`.
  - **LÃ³gica/Flujo:** Implementar `CreateTenantUseCase` y `ActivateTenantUseCase`. Escribir tests unitarios (mockeando dependencias).
  - **Artefactos:** `create-tenant.use-case.ts`, `activate-tenant.use-case.ts` y sus `*.spec.ts`.
  - **Ruta:** `libs/core/application/tenancy/`
  ***
